TCP의 연결해제과정은 다음과 같이 4개의 과정으로이루어집니다.
1. 먼저 클라이언트가 연결을 닫으려고 할 때 FIN으로 설정된 세그먼트를 보냅니다. 그리고 클라이언트는 FIN_WAIT_1 상태로 들어가고 서버의 응답을 기다립니다.

2. 서버는 클라이언트로 ACK라는 승인 세그먼트를 보내고 CLOSE_WAIT 상태에 들어갑니다. 클라이언트가 세그먼트를 받으면 FIN_WAIT_2 상태에 들어갑니다.

3. 서버는 LAST_ACK상태가 되며 일정 시간 이후에 클라이언트에 FIN이라는 세그먼트를 보냅니다.

4. 클라이언트는 TIME_WAIT 상태가 되고 다시 서버로 ACK를 보내서 서버는 CLOSED 상태가 되며 이후 클라이언트는 어느 정도의 시간(TIME_WAIT으로 설정된 시간)을 대기한 후 연결이 닫힙니다.

![](https://velog.velcdn.com/images/cjllee/post/01b51889-3c31-479e-b83e-bb43ded2cbe8/image.png)
### TIME_WAIT
TIME_WAIT는 지연 패킷 등이 발생했을 때 데이터 무결성을 해결하기 위해 패킷을 기다리는 시간을 말합니다. 2 * MSL동안 기다립니다.

또한 연결이 올바르게 닫힌 상태로 만들기 위해 존재하기도 합니다. 예를 들어 CLOSED가 아닌 LAST_ACK로 되어 있으면 그 다음 연결 때 오류가 나타나기 때문에 일정시간 기다리는 TIME_WAIT가 필요합니다. 이는 CentOS6, 우분투에는 60초로 설정되어 있으며 윈도우는 4분으로 설정되어 있습니다. 즉, OS마다 조금씩 다를수 있습니다.

- MSL은 maximum segment lifetime로 최대 패킷 수명을 말합니다.
